@using Commons;

@{
    ViewBag.Title = "AddEditClinic";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var formName = (Int32) Commons.Enums.ScreenID.AddEditClinic;
}

@Styles.Render("~/Content/ScreenCSS")
@Scripts.Render("~/bundles/ScreenScripts")
<script src="@Url.Content("~/Scripts/ActionScripts/ClinicScripts.js")"></script>

@using (Html.BeginForm(null, null, FormMethod.Post, new { @enctype = "multipart/form-data", name = formName, id = formName, @class = "floating-labels form-horizontal" }))
{
    <div class="page-wrapper">
        <div class="container-fluid">
            <div class="row page-titles">
                <div class="col-md-5 align-self-center">
                    <h4 class="text-themecolor">Add Clinic</h4>
                </div>
                <div class="col-md-7 align-self-center text-right">
                    <div class="d-flex justify-content-end align-items-center">
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="javascript:void(0)">Clinic</a></li>
                            <li class="breadcrumb-item active">Add Clinic</li>
                        </ol>
                        @*<button type="button" class="btn btn-info d-none d-lg-block m-l-15"><i class="fa fa-plus-circle"></i> Create New</button>*@
                        <input type="hidden" id="hdnClinicCode" name="hdnClinicCode" value="@Constants.ClinicCode" />
                        <input type="hidden" class="clearHdnText" id="Clinic_ID" name="Clinic_ID" value="0"/>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-6">
                    <div class="card FirstCard">
                        <div class="card-body">
                            <h5 class="card-title"> Clinic Information </h5>
                            <h6 class="card-subtitle">Asterik(*) Fields Are Required.</h6>
                            <div class="form-group m-t-40">
                                <input type="text" id="txtClinicName" name="txtClinicName" class="form-control floating-Input AlphabetsOnly clearText" value="">
                                <span class="bar"></span>
                                <label for="txtClinicName">Clinic Name</label>
                            </div>
                            <div class="form-group">
                                <input type="text" id="txtAcronym" name="txtAcronym" class="form-control floating-Input AlphabetsOnly clearText" value="">
                                <span class="bar"></span>
                                <label for="txtAcronym">Acronym</label>
                            </div>
                            <div class="form-group">
                                <input type="text" id="txtNTNnumber" name="txtNTNnumber" class="form-control floating-Input NTNNumberMasking clearText" value="">
                                <span class="bar"></span>
                                <label for="txtNTNnumber">NTN Number</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-sm-6">
                    <div class="card FirstCard">
                        <div class="card-body">
                            <h5 class="card-title">Upload Logo</h5>
                            <h6 class="card-subtitle">Logo should be in PNG.</h6>
                            <div class="m-t-30">
                                <input type="file" id="input-file-now" class="dropify" />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-body">
                            <h5 class="card-title">Contact Information</h5>
                            <h6 class="card-subtitle">Asterik(*) Fields Are Required.</h6>
                            <div class="row m-t-40">
                                <div class="col-lg-4 form-group">
                                    <input type="text" id="txtContactNumber" name="txtContactNumber" class="form-control floating-Input PhoneNoMasking clearText" value="">
                                    <span class="bar"></span>
                                    <label for="txtContactNumber">Phone No.</label>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <input type="text" id="txtEmailID" name="txtEmailID" class="form-control floating-Input clearText" value="">
                                    <span class="bar"></span>
                                    <label for="txtEmailID">Email ID</label>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <input type="text" id="txtWebsite" name="txtWebsite" class="form-control floating-Input clearText" value="">
                                    <span class="bar"></span>
                                    <label for="txtWebsite">Website</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <select class="form-control floating-Select resetDDL" id="ddlStartTime">
                                        <option value=""></option>
                                    </select><span class="bar"></span>
                                    <label for="ddlStartTime">Start Time</label>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <select class="form-control floating-Select resetDDL" id="ddlEndTime">
                                        <option value=""></option>
                                    </select><span class="bar"></span>
                                    <label for="ddlEndTime">End Time</label>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <select class="form-control floating-Select resetDDL" id="ddlCloseDay">
                                        <option value=""></option>
                                    </select><span class="bar"></span>
                                    <label for="ddlCloseDay">Close Day</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-4 form-group">
                                    <select class="form-control floating-Select resetDDL" id="ddlCountry">
                                        <option value=""></option>
                                    </select><span class="bar"></span>
                                    <label for="ddlCountry">Country</label>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <select class="form-control floating-Select resetDDL" id="ddlState">
                                        <option value=""></option>
                                    </select><span class="bar"></span>
                                    <label for="ddlState">State</label>
                                </div>
                                <div class="col-lg-4 form-group">
                                    <select class="form-control floating-Select resetDDL" id="ddlCity">
                                        <option value=""></option>
                                    </select><span class="bar"></span>
                                    <label for="ddlCity">City</label>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-lg-12 form-group">
                                    <textarea class="form-control floating-TextArea clearText" rows="2" id="txtAddress"></textarea>
                                    <span class="bar"></span>
                                    <label for="txtAddress">Address</label>
                                </div>
                                <div class="col-lg-12 form-group">
                                    <textarea class="form-control floating-TextArea clearText" rows="2" id="txtDiscription"></textarea>
                                    <span class="bar"></span>
                                    <label for="txtDiscription">Discription</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="card">
                        <div style="text-align: center;" class="card-body">
                            <div class="row">
                                <div class="col-lg-8 col-md-8 col-sm-12"></div>
                                <div class="btn-p col-lg-2 col-md-2 col-sm-12">
                                    <button type="button" id="addEditClinic" class="btn-custom btn btn-success waves-effect waves-light"><i class="fa fa-save"></i>&nbsp; Save</button>
                                </div>
                                <div class="btn-p col-lg-2 col-md-2 col-sm-12">
                                    <button type="button" id="cancelRecords" class="btn-custom btn btn-inverse waves-effect waves-light"><i class="fa fa-times"></i>&nbsp; Cancel</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<script>
    var Clinic = (function () {

        var baseUrl = "";

        var init = function () {
            Clinic.bindPageEvents();
            Clinic.GetDays();
            Clinic.GetTimeSlot();

            var arrCountry = [];
            arrCountry.push(new common.DropDown(0, "Country"));
            common.FillDropDownListWithParem("ddlCountry", "", common.CommonURLs.GetDropDownData, arrCountry, "Country", "Error");

            $('#ddlCountry').on('change', function () {
                var arrState = [];
                arrState.push(new common.DropDown($('#ddlCountry').val(), "Country"));
                common.FillDropDownListWithParem("ddlState", "", common.CommonURLs.GetDropDownData, arrState, "State", "Error");
            });

            $('#ddlState').on('change', function () {
                var arrCity = [];
                arrCity.push(new common.DropDown($('#ddlCountry').val(), "Country"));
                arrCity.push(new common.DropDown($('#ddlState').val(), "State"));
                common.FillDropDownListWithParem("ddlCity", "", common.CommonURLs.GetDropDownData, arrCity, "City", "Error");
            });

            //var id = common.GetParameterFromURL('ClinicID');
            //if (id > 0) {
            //    Clinic.GetClinicData(id);
            //}

            Clinic.GetClinicData();
        };

        var GetClinicData = function () {
            URL = "/Clinic/GetClinicDetailByID?RequestVerificationToken=@Utility.TokenHeaderValue()";
            $.ajax({
                url: URL,
                type: "GET",
                dataType: 'json',
                //data: { "clinicID": clinicID },
                async: false,
                success: function (data) {
                    if (data != 'Error') {

                        Clinic.PopulateValue(data)
                    } else {
                        common.ErrorMessage(common.Message.Error);
                    }
                },
                error: function () {
                    common.ErrorMessage(common.Message.Error)
                }
            });
        }

        var PopulateValue = function (data) {
            debugger;
            $("#Clinic_ID").val(data[0]['Clinic_ID'])
            $("#txtClinicName").val(data[0]['Name']);
            $("#txtAcronym").val(data[0]['Acronym']);
            $("#txtNTNnumber").val(data[0]['NTN_Number']).trigger('input');
            $("#txtContactNumber").val(data[0]['Contact']).trigger('input');
            $("#ddlStartTime").val(data[0]['Time_Start_ID']);
            $("#ddlEndTime").val(data[0]['Time_End_ID']);
            $("#ddlCloseDay").val(data[0]['Closing_Day']);
            $("#txtEmailID").val(data[0]['Email']);
            $("#txtWebsite").val(data[0]['Website']);
            $("#ddlCountry").val(data[0]['Country']).trigger('change');
            $("#ddlState").val(data[0]['State']).trigger('change');
            $("#ddlCity").val(data[0]['City']);
            $("#txtDiscription").val(data[0]['Discription']);
            $("#txtAddress").val(data[0]['Address']);
            common.SetFormLabel();
        }

        var GetTimeSlot = function () {
            var arrTime = [];
            arrTime.push(new common.DropDown(0, "Time"));
            common.FillDropDownListWithParem("ddlStartTime", "", common.CommonURLs.GetDropDownData, arrTime, "Time", "Error");
            common.FillDropDownListWithParem("ddlEndTime", "", common.CommonURLs.GetDropDownData, arrTime, "Time", "Error");
        }

        var GetDays = function () {
            var arrDays = [];
            arrDays.push(new common.DropDown(0, "Days"));
            common.FillDropDownListWithParem("ddlCloseDay", "", common.CommonURLs.GetDropDownData, arrDays, "Days", "Error");
        }

        var ValidForm = function () {
            var msg = '';
            alertMsgFlag = false;

            var EmailID = $("#txtEmailID").val()
            if (!common.ValidEmail(EmailID)) {
                alertMsgFlag = true;
                msg = msg + "- Email is Invalid. <br/>";
            }

            if (alertMsgFlag) {
                bootbox.alert({ title: "Please provide value for following field(s):", message: msg });
                return false;
            }
            else {
                return true;
            }
        }

        var bindPageEvents = function () {

            $("#addEditClinic").on("click", function () {

                if (Clinic.ValidForm()) {
                    var data = {
                        Clinic_ID: $("#Clinic_ID").val(),
                        Name: $("#txtClinicName").val(),
                        Acronym: $("#txtAcronym").val(),
                        NTN_Number: common.RemoveDashes($("#txtNTNnumber").val()),
                        Contact: common.RemoveDashes($("#txtContactNumber").val()),
                        Email: $("#txtEmailID").val(),
                        Website: $("#txtWebsite").val(),
                        Country: $("#ddlCountry").val(),
                        City: $("#ddlCity").val(),
                        State: $("#ddlState").val(),
                        Address: $("#txtAddress").val(),
                        Discription: $("#txtDiscription").val(),
                        Clinic_Code: $("#hdnClinicCode").val(),
                        Time_Start_ID: $("#ddlStartTime").val(),
                        Time_Start: $("#ddlStartTime option:selected").text(),
                        Time_End_ID: $("#ddlEndTime").val(),
                        Time_End: $("#ddlEndTime option:selected").text(),
                        Closing_Day: $("#ddlCloseDay").val(),
                        Logo: '~/Content/Images/Logo/IMG-5200.png'
                    }

                    //var ID = $("#Clinic_ID").val();
                    //var URL = "/Clinic/AddClinicIndformation/";

                    //if (ID > 0) {
                    //    URL = "/Clinic/UpdateClinicIndformation/";
                    //}

                    URL = "/Clinic/UpdateClinicIndformation/";

                    $.ajax({
                        url: URL,
                        type: "POST",
                        //contentType: false,
                        dataType: 'json',
                        data: data,
                        cache: false,
                        async: true,
                        success: function (data) {
                            debugger;
                            if (data == 'Success') {
                                var IMG = 'IMG-' + $("#hdnClinicCode").val();
                                common.SaveFileOrImage('input-file-now', 'Logo', IMG);
                                common.SuccessMessage(common.Message.Success);
                                common.ResetForm();
                                common.SetFormLabel();
                            } else {
                                common.ErrorMessage(common.Message.Error);
                            }
                        },
                        error: function () {
                            common.ErrorMessage(common.Message.Error)
                        }
                    });
                };
            });


            $("#deleteClinic").on("click", function () {
                var ClinicID = $("#Clinic_ID").val();

                if (ClinicID > 0) {
                    common.ConfirmBox(function (result) {
                        if (result) {

                            $.ajax({
                                url: '/Clinic/DeleteClinic/',
                                type: "POST",
                                data: JSON.stringify({ ClinicID: ClinicID }),
                                dataType: 'json',
                                contentType: "application/json; charset=utf-8",
                                async: false,
                                success: function (data) {
                                    if (data != false) {
                                        common.SuccessMessage(common.Message.Delete);
                                        common.ResetForm();
                                        common.SetFormLabel();
                                    }
                                    else {
                                        common.ErrorMessage(common.Message.Error)
                                    }
                                },
                                error: function (data) {
                                    //alert(data);
                                    ShowErrorMsg('error', data, 'client', FTPConfigFormId);
                                }
                            });

                        }

                    }, common.Message.Confirm);
                }

                else {
                    bootbox.alert("Please select record(s) to delete.");
                }

            });
        };

        return {
            init: init,
            bindPageEvents: bindPageEvents,
            ValidForm: ValidForm,
            GetClinicData: GetClinicData,
            PopulateValue: PopulateValue,
            GetDays: GetDays,
            GetTimeSlot: GetTimeSlot
        };
    })();

    $(document).ready(function () {
        Clinic.init();
        //File Upload
        $(".fileinput-upload-button").hide();

        //File Drop and Upload
        $('.dropify').dropify();

        //File Drop and Upload Used events
        var drEvent = $('#input-file-events').dropify();

        drEvent.on('dropify.beforeClear', function (event, element) {
            return confirm("Do you really want to delete \"" + element.file.name + "\" ?");
        });

        drEvent.on('dropify.afterClear', function (event, element) {
            alert('File deleted');
        });

        drEvent.on('dropify.errors', function (event, element) {
            console.log('Has Errors');
        });

        var drDestroy = $('#input-file-to-destroy').dropify();
        drDestroy = drDestroy.data('dropify')
        $('#toggleDropify').on('click', function (e) {
            e.preventDefault();
            if (drDestroy.isDropified()) {
                drDestroy.destroy();
            } else {
                drDestroy.init();
            }
        });
    })
</script>